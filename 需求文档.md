# 表情包图片压缩器 - 产品需求文档

## 📋 项目概述

### 背景
微信表情包平台限制上传图片大小为 500kb 以下。现有压缩工具存在以下痛点：
- 缺乏批量处理能力
- 压缩后部分图片仍超过目标大小
- 二次压缩效果不佳，无法精准控制文件大小
- 压缩结果与预期偏差较大

### 目标
开发一款基于 Web 的图片批量压缩工具，实现精准的文件大小控制，确保所有图片压缩后符合微信表情包上传要求。

---

## 🎯 核心功能

### 1. 图片上传
- **拖拽上传**：支持多图拖拽到页面
- **点击上传**：传统文件选择方式
- **批量处理**：一次性选择多张图片
- **格式支持**：JPG、PNG、WEBP 等常见格式

### 2. 智能压缩
- **目标大小设定**：用户可设置最大文件大小（默认 500kb）
- **精准压缩**：压缩结果与设置值尽可能接近
- **迭代优化**：自动调整压缩参数直至符合要求
- **质量保持**：在满足大小要求的前提下尽可能保持画质

### 3. 批量下载
- **单图下载**：单独下载某张压缩后的图片
- **批量打包**：一键下载所有压缩后的图片（ZIP 格式）
- **文件命名**：保留原文件名或添加后缀标识

### 4. 进度反馈
- **实时进度条**：显示当前压缩进度
- **压缩统计**：显示原大小、压缩后大小、压缩比例
- **视觉对比**：可选的原图与压缩图对比预览

---

## 🎨 设计风格

### 视觉定位
- **极简主义**：参考 Notion / Apple Design 的简约风格
- **配色方案**：
  - 主色：深灰/黑色系 `#1C1C1E`
  - 辅助色：浅灰 `#F2F2F7`、`#E5E5EA`
  - 强调色：橙色 `#FF6B00`（用于关键操作按钮）
  - 文字：深色 `#1C1C1E` / 浅色模式适配
  - 状态色：绿色 `#34C759`（成功）、红色 `#FF3B30`（失败）

### UI 元素
- **圆角卡片**：12px - 16px 圆角
- **微投影**：细腻的阴影效果 `0 2px 8px rgba(0,0,0,0.08)`
- **留白充足**：避免信息密集，保持呼吸感
- **字体层级**：清晰的信息层级，使用系统字体栈

---

## 📐 页面布局

### 整体结构
```
┌─────────────────────────────────────────────┐
│               页面标题区                      │
│         表情包图片压缩器                      │
│    微信表情包上传专用 · 精准压缩              │
├─────────────────────────────────────────────┤
│                                             │
│           ┌─────────────────┐               │
│           │   拖拽上传区域   │               │
│           │  或点击选择图片  │               │
│           └─────────────────┘               │
│                                             │
├─────────────────────────────────────────────┤
│          压缩设置                            │
│  目标大小: [500] KB  ✓ 自动迭代优化         │
├─────────────────────────────────────────────┤
│  [批量下载全部]  已完成: 0/0                │
├─────────────────────────────────────────────┤
│                                             │
│          图片矩阵列表                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ [缩略图] │  │ [缩略图] │  │ [缩略图] │ │
│  │ image1   │  │ image2   │  │ image3   │ │
│  │ 1.2MB →  │  │ 890KB →  │  │ 2.1MB →  │ │
│  │ 498KB ✅ │  │ 475KB ✅ │  │ 487KB ✅ │ │
│  │[预览][↓] │  │[预览][↓] │  │[预览][↓] │ │
│  └──────────┘  └──────────┘  └──────────┘ │
│                                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ [缩略图] │  │ [缩略图] │  │ [缩略图] │ │
│  │ image4   │  │ image5   │  │ image6   │ │
│  │ 650KB →  │  │ 1.8MB →  │  │ 920KB →  │ │
│  │ 412KB ✅ │  │ 495KB ✅ │  │ 468KB ✅ │ │
│  │[预览][↓] │  │[预览][↓] │  │[预览][↓] │ │
│  └──────────┘  └──────────┘  └──────────┘ │
│                                             │
└─────────────────────────────────────────────┘
```

### 布局说明
- **图片矩阵**：响应式网格布局，自适应屏幕宽度
  - 大屏幕：4-5 列
  - 中等屏幕：3 列
  - 小屏幕：2 列
- **卡片信息**：
  - 顶部：图片缩略图（150x150px，裁剪居中）
  - 文件名：最多显示 20 字符，超出省略
  - 压缩信息：原大小 → 压缩后大小 + 状态标识
  - 操作按钮：预览、下载（图标按钮）

---

## 🔧 技术实现要点

### 压缩算法
```javascript
核心逻辑：
1. 使用 canvas 的 toBlob() 方法进行压缩
2. 二分查找最优 quality 参数（0-1）
3. 如仍不符合要求，调整图片尺寸
4. 迭代上限：5 次，防止无限循环

伪代码：
function compressImage(file, maxSizeKB) {
  let quality = 0.9
  let iteration = 0
  const maxSize = maxSizeKB * 1024

  while (iteration < 5) {
    blob = canvas.toBlob('image/jpeg', quality)
    if (blob.size <= maxSize) {
      return blob
    }
    quality -= 0.1
    iteration++
  }

  // 如果调整质量仍不够，缩小尺寸
  // ...
}
```

### 性能优化
- **Web Worker**：压缩过程在后台线程执行，避免阻塞 UI
- **分批处理**：每次最多同时处理 5 张图片
- **内存管理**：及时释放 canvas 对象，防止内存溢出

---

## ✅ 验收标准

### 功能完整性
- [x] 支持拖拽和点击上传
- [x] 可自定义目标文件大小
- [x] 批量压缩多张图片
- [x] 压缩后 100% 符合设定大小限制
- [x] 单图和批量下载功能
- [x] 实时显示压缩进度和结果统计

### 用户体验
- [x] 界面简洁美观，符合设计规范
- [x] 操作流程直观，无需说明即可使用
- [x] 响应式设计，支持不同屏幕尺寸
- [x] 压缩速度快，提供进度反馈

### 压缩质量
- [x] 在符合大小要求的前提下，尽可能保持清晰度
- [x] 支持主流图片格式
- [x] 压缩结果稳定，不会随机超限

---

## 📱 未来扩展（可选）

- v1.1
  - 添加压缩预设（微信、QQ、钉钉等不同平台）
  - 支持水印添加
  - 历史记录功能

- v2.0
  - PWA 支持，可离线使用
  - 图片格式批量转换
  - GIF 表情包支持

---

## 📊 成功指标

- 压缩成功率：≥ 99%（所有图片压缩后都符合要求）
- 用户操作步骤：≤ 3 步完成整个流程
- 页面加载速度：< 1 秒
- 平均压缩时间：< 2 秒/张（5MB 以内图片）

---

*文档版本：v1.0*
*创建日期：2026-01-14*
*状态：待开发*
